openapi: "3.0.3"
info:
  title: "Delilah Resto"
  description: "API for the management of restaurant orders and deliveries. Users can register, list the available products,
  place orders, read and update their information. An admin user can see and update all orders and products, create, update and delete products,
  as well as reading all the users' information."
  version: "1.0.0"
  contact:
    name: "Aldana Daniela Casal"
    url: "https://github.com/aldanadc"
  license:
    name: "ISC"
servers:
  - url: "https://localhost:8080/api/1.0.0"
    description: "Local server"
paths:
  /login:
    post:
      summary: "Login to user account"
      description: "Allows an user to log into their account if they are a registered user"
      requestBody:
        description: "User's log in information"
        required: true
        content:
          application/json:
            schema:
                $ref: "#/components/schemas/LogIn"
            example:
              username: "queen_freddie"
              password: "Eeeeeeoo123"
      responses:
        "200":
          $ref: "#/components/responses/200Success"
          description: "User token"
          content:
          application/json:
        "401":
          $ref: "#/components/responses/401NotAuthenticated"
        "500":
          $ref: "#/components/responses/500DefaultError"
      security: []

  /register:
    post:
      summary: "Create a new user"
      description: "Allows a new user to create an account provided they complete all the necessary information"
      requestBody:
        description: "New user's information"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/newUser"
            example:
              $ref: "#/components/examples/newUser"
      responses:
        "201":
          $ref: "#/components/responses/201Created"
          description: "New user's object which was created"
          content:
          application/json:
        "400":
          $ref: "#/components/responses/400BadRequest"
        "500":
          $ref: "#/components/responses/500DefaultError"
      security: []

  /products:
    get:
      summary: "Fetch all available products"
      description: "Returns an array of objects with details of all the available products"
      responses:
        "200":
          $ref: "#/components/responses/200Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Products"
              example:
                $ref: "#/components/examples/Products"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
    post:
      summary: "Create a new product"
      description: "Allows an admin user to create a new product following a set structure and add it to the available products"
      requestBody:
        description: "New product's details"
        required: true
        content:
          application/json:
              schema:
                $ref: "#/components/schemas/NewProduct"
      responses:
        "201": 
          $ref: "#/components/responses/201Created"
          description: "Details of the newly created product"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
              example:
                $ref: "#/components/examples/NewProduct"
        "400":
          $ref: "#/components/responses/400BadRequest"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /products/{product_id}:
    parameters:
        - in: path
          name: product_id
          required: true
          schema:
            type: string
          description: "Numeric ID of the product to operate on"
          example: 3
    get:
      summary: "Returns the details of a product searching by its ID"
      responses:
        "200":
          $ref: "#/components/responses/200Success"
          description: "Details of the fetched product"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
              example:  
                $ref: "#/components/examples/Product"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
    patch:
      summary: "Update an existing product"
      description: "Allows an admin user to partially update the details for an existing product"
      requestBody:
        description: "Information to be updated on the product"
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Product"
            example:
              price: 399.99
              is_disabled: false
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          description: "Details of the product after its update"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Product"
        "400":
          $ref: "#/components/responses/400BadRequest"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
    delete:
      summary: "Delete an existing product"
      description: "Allows an admin user to delete an existing product by using its ID as path parameter"
      responses:
        "204":
          description: "Product deleted"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /products/disabled:
    get:
      summary: "Returns products currently disabled"
      description: "Returns a list of objects with information about the products currently set as disabled. Only admin users can see this information"
      responses:
        "200":
          $ref: "#/components/responses/200Success"
          description: "Details of the currently disabled products"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Products"
              example:  
                $ref: "#/components/examples/Products"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /users:
    get:
      summary: "Returns the information for all registered users"
      description: "Returns a list of objects with details of all registered users. Only admin users can see this information"
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          description: "Details of the registered users"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Users"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /users/{user_id}:
    parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: string
          description: "Numeric ID of the user to operate on"
          example: 3
    get:
      summary: "Returns information about a specified user"
      description: "Returns a list with an object with the details of the requested user. A non-admin user will only get a successful response if they are asking for their own information"
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          description: "Details of the specified user"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
              example:
                $ref: "#/components/examples/User"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
    patch:
        summary: "Update information for an existing user"
        description: "Allows registered users to update their stored information. All users can only update their own details "
        requestBody:
          description: "User's new information"
          required: true
          content:
            application/json:
                example:
                  address: "10 Downing Street, London SW1A 2AB, UK"
                  phone_number: "+446565605898"
        responses:
          "200": 
            $ref: "#/components/responses/200Success"
            description: "Details of the user after its update"
            content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
              example:
                $ref: "#/components/examples/User"
          "400":
            $ref: "#/components/responses/400BadRequest"
          "401": 
            $ref: "#/components/responses/401NotAuthenticated"
          "403": 
            $ref: "#/components/responses/403Forbidden"
          "500":
            $ref: "#/components/responses/500DefaultError"
    delete:
      summary: "Delete an existing user"
      description: "Allows all users to delete their own user account"
      responses:
        "204":
          description: "User deleted"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /users/{user_id}/favs:
    get:
      summary: "Returns information about an user's favourites products"
      description: "Returns an array of objects with the specified user's id, username and an array containing their associated favourite products. An admin user can see everybody's favourites but a non-admin user can only see their own"
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: string
          description: "Numeric ID of the user to operate on"
          example: 5
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          content:
            application/json:
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /orders:
    get:
      summary: "Returns information about current day's orders"
      description: "For admin users, returns an array of objects containing the restaurant's current day's orders, from 00hs to 23.59hs. For non-admin users, it returns the orders they placed on that day if they have any. The products associated to each order are also included in the order's information"
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Orders"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "404": 
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
    post:
      summary: "Create a new order"
      description: "Allows a registered user to send a new order to the restaurant, choosing the products they want and the payment method"
      requestBody:
        description: "Details of the order to be sent"
        required: true
        content:
          application/json:
              schema:
                $ref: "#/components/schemas/NewOrder"
              example:
                $ref: "#/components/examples/NewOrder"
      responses:
        "201":
          $ref: "#/components/responses/201Created"
          description: "Details of the order sent"
        "400":
          $ref: "#/components/responses/400BadRequest"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /orders/{order_id}:
    parameters:
        - in: path
          name: order_id
          required: true
          schema:
            type: integer
          description: "Numeric ID of the order to operate on"
          example: 5
    get:
      summary: "Get an order's details"
      description: "Returns an object with information about the specified order's details. A non-admin user can only see the information if they were the ones that placed the order"
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Order"
              example:
                $ref: "#/components/examples/Order"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
    patch:
      summary: "Update an order's status"
      description: "Allows an admin user to update the specified order's status, following one of the pre-set stages"
      requestBody:
        description: "Order's new status"
        required: true
        content:
          application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    enum:
                      - "new"
                      - "confirmed"
                      - "preparing"
                      - "sending"
                      - "cancelled"
                      - "delivered"
              
      responses:
        "204": 
          description: "Order status updated"
        "400":
          $ref: "#/components/responses/400BadRequest"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "403": 
          $ref: "#/components/responses/403Forbidden"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
        
  /history:
    get:
      summary: "Returns information about all of the orders for the restaurant"
      description: "Returns a list of objects containing information about all the orders placed.  If the user is non-admin, they will only see the orders they placed"
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Orders"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"

  /history/{date}:
    get:
      summary: "Returns information about orders placed on a specified date"
      description: "Returns a list of objects containing information about the specified date's orders. The array will be empty if no orders were place that day"
      parameters:
        - in: path
          name: date
          required: true
          schema:
            type: string
          description: "Date used to fetch orders' history in format YYYY,MM,DD"
          example:
            "2021,04,05"
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Orders"
        "400":
          $ref: "#/components/responses/400BadRequest"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"
  
  /history/user/{user_id}:
    get:
      summary: "Returns information about a user's order history"
      description: "Returns a list of objects containing information about the specified user's order history. Only admin users can access this content"
      parameters:
        - in: path
          name: user_id
          required: true
          schema:
            type: string
          description: "Numeric ID of the user to fetch history for"
          example: 3
      responses:
        "200": 
          $ref: "#/components/responses/200Success"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Orders"
        "401": 
          $ref: "#/components/responses/401NotAuthenticated"
        "404":
          $ref: "#/components/responses/404NotFound"
        "500":
          $ref: "#/components/responses/500DefaultError"

security:
  - tokenAuth: []

components:
  securitySchemes:
    tokenAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    Product:
      type: object
      properties:
        product_id:
          type: number
        name:
          type: string
        description:
          type: string
        image:
          type: string
        ingredients:
          type: string
        price:
          type: number
        is_disabled:
          type: boolean
    Products:
      type: array
      items:
        $ref: "#/components/schemas/Product"
    NewProduct:
      type: object
      properties:
        name:
          type: string
        description:
          type: string
        image:
          type: string
        ingredients:
          type: string
        price:
          type: number
        is_disabled:
          type: boolean
    User: 
      type: object
      properties:
        user_id:
          type: number
        username:
          type: string
        full_name:
          type: string
        email:
          type: string
          format: email
        phone_number:
          type: string
        address:
          type: string
        password:
          type: string
          format: password
        is_admin:
          type: boolean
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Users:
      type: array
      items:
        $ref: "#/components/schemas/User"
    newUser: 
      type: object
      properties:
        username:
          type: string
        full_name:
          type: string
        email:
          type: string
          format: email
        phone_number:
          type: string
        address: 
          type: string
        password:
          type: string
          format: password
        is_admin:
          type: boolean
    LogIn: 
      type: object
      properties:
        username:
          type: string
        password:
          type: string
    OrderItem:
      type: object
      properties:
        product_id:
          type: number
        name:
          type: string
        image:
          type: string
        price:
          type: number
          format: float
        order_products:
          type: object
          properties:
            product_qty:
              type: integer
    Order:
      type: object
      properties:
        order_id:
          type: integer
        status:
          type: string
          enum:
            - "new"
            - "confirmed"
            - "preparing"
            - "on its way"
            - "cancelled"
            - "delivered"
        payment_method:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        user_id:
          type: integer
        order_items:
          type: array
          items:
            $ref: "#/components/schemas/OrderItem"
    Orders:
      type: array
      items:
        $ref: "#/components/schemas/Order"
    NewOrder:
      type: object
      properties:
        payment_method:
          type: string
        orders_products:
          type: array
          items:
            type: object
            properties:
              product_qty:
                type: number
              product_id:
                type: number
    Error:
      type: object
      properties:
        code:
          type: integer
        message:
          type: string
      required:
        - code
        - message
  responses:
    200Success:
      description: "Request sucessful"
    201Created:
      description: "Resource created"
    400BadRequest:
      description: "Incorrect or missing information provided"
    401NotAuthenticated:
      description: "Invalid or missing credentials"
    403Forbidden:
      description: "Forbidden action. The user is not authorized to perform the request"
    404NotFound:
      description: "The requested resource does not exist"
    500DefaultError:
      description: "Internal server error"
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
  examples:
    Product:
      value:
        product_id: 1
        name: "Tacos al pastor"
        description: "Delicious taco with marinated pork and veal meat, with roasted vegetables, seasoning and hot sauce"
        image: "http://imagendetacos.com"
        ingredients: "pork and veal meat, hot chili, garlic, onion, cilantro leaves, cumin, salt, pineapple, corn tortilla"
        price: 349.99
        is_disabled: false
    Products:
      value:
        - product_id: 1
          name: "Tacos al pastor"
          description: "Delicious taco with marinated pork and veal meat, with roasted and fresh vegetables, seasoning and hot sauce"
          ingredients: "pork and veal meat, hot chili, garlic, onion, cilantro leaves, cumin, salt, pineapple, corn tortilla"
          price: 349.99
          is_disabled: false
        - product_id: 2
          name: "Carnitas burrito"
          description: "Our star burrito, made with marinated pork meat, roasted and fresh vegetables, black beans, cheese and white rice, seasoned with our delicious hot sauce"
          ingredients: "marinated pork meat, white rice, black beans, onion, tomato, lettuce, cilantro leaves, hot chili, avocado, salt, corn tortilla"
          price: 379.99
          is_disabled: true
    NewProduct:
      value:
        name: "Tacos al pastor"
        description: "Delicious taco with marinated pork and veal meat, with roasted vegetables, seasoning and hot sauce"
        image: "http://imagendetacos.com"
        ingredients: "pork and veal meat, hot chili, garlic, onion, cilantro leaves, cumin, salt, pineapple, corn tortilla"
        price: 349.99
        is_disabled: false
    User:
      value:
        user_id: 3
        username: "queen_freddie"
        full_name: "Freddie Mercury"
        email: "freddiemercury@gmail.com"
        phone_number: "+447712345678"
        address: "1 Logan Pl, Kensington, London, W8 6DE, UK"
        password: "Eeeeeeoo123"
        is_admin: false
        created_at: "2021-05-05T16:18:11.000Z"
        updated_at: "2021-05-05T16:18:11.000Z"
    newUser:
      value:
        username: "queen_freddie"
        full_name: "Freddie Mercury"
        email: "freddiemercury@gmail.com"
        phone_number: "+447712345678"
        address: "1 Logan Pl, Kensington, London, W8 6DE, UK"
        password: "Eeeeeeoo123"
        is_admin: false
    Order:
      value:
        order_id: 75
        order_status: "new"
        payment_method: "cash"
        created_at: "2021-05-05T23:23:59.000Z"
        updated_at: "2021-05-05T23:23:59.000Z"
        user_id: 3
        order_items:
          - product_id: 2
            name: "Tacos al pastor"
            image: "http://imagendetacos.com"
            price: 349.99
            order_products: 
              - product_qty: 1
    NewOrder:
      value:
        payment_method: "cash"
        order_products:
          - product_qty: 2
            product_id: 3
          - product_qty: 2
            product_id: 1
